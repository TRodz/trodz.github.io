<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Creando una estrategia de búfer para un simple juego (Java)</title>
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../assets/css/ghostion.min.css" />

    <!-- <link rel="stylesheet" href="/assets/css/ghostion.custom.css" /> -->

    <meta name="generator" content="Ghost 0.5" />
<link rel="alternate" type="application/rss+xml" title="El aprendiz del game design" href="../rss/index.html">
<link rel="canonical" href="http://trodz.github.io/estrategia-de-bufer/" />
</head>
<body class="post-template">
    <div id="at_page_surround">
        <div id="at_body">
            
<div class="left-off-canvas-menu">
	<ul class="off-canvas-list">
		<li><label>Menu principal </label></li>
		<li><a class="at_menu_item" href="http://trodz.github.io"><span class="fa fa-home"></span> Inicio</a></li>
		<li><a class="at_menu_item" href="http://trodz.github.io/about"><span class="fa fa-user"></span> Acerca</a></li>
	</ul>
</div>
<div id="at_header">
    <div class="row">
        <div class="medium-4 columns">
            <div class="at_logo_container">
                        <a href="http://trodz.github.io">
                    <span class="at_logo_text">El aprendiz del game design</span></a>
            </div>
        </div>
        <div class="medium-4 columns text-right hide-for-small-only">
            <div class="at_icon_menu">
                <a class="at_icon_menu_item" href="http://trodz.github.io/about" data-tooltip class="has-tip" title="Acerca"><span class="fa fa-user"></span></a>
                <a class="at_icon_menu_item" href="https://github.com/TRodz/" data-tooltip class="has-tip" title="Github"><span class="fa fa-github"></span> <span></span></a>
                <a class="at_icon_menu_item" href="https://twitter.com/timrodz" data-tooltip class="has-tip" title="Twitter"><span class="fa fa-twitter"></span> <span></span></a>
                <a class="at_icon_menu_item" href="https://www.facebook.com/TRodz24" data-tooltip class="has-tip" title="Facebook"><span class="fa fa-facebook"></span> <span></span></a>
                <a class="at_icon_menu_item" href="https://mad-hyrax.github.io" data-tooltip class="has-tip" title="Sitio web"><span class="fa fa-code"></span></a>
            </div>
        </div>
        <div class="medium-4 columns">
            <div id="at_search">
            	<div class="row">
            		<div class="large-12 large-centered columns">
            			<input class="at_search_input" type="text" placeholder="Buscar...">
            		</div>
            	</div>
            	<div class="at_search_results"></div>
            </div>        </div>
    </div>
</div>
<div id="at_showcase">
	<div class="at_blog_cover" style="background-image: url(../content/images/2014/Sep/Where-Tahrs-Live.jpg)">
	    <div class="at_showcase_overlay at_with_blog_cover">
			<div class="row">
				<div class="large-12 large-centered columns">
					<div class="at_block">
						<div class="text-center">
				            <div class="at_block">
				                <article class="post">
				                    <div class="at_post_header">
				                        <h2 class="at_post_title">Creando una estrategia de búfer para un simple juego (Java)</h2>
				                    </div>
				                    <div class="at_post_meta">
				                        <span class="at_featured_post"><span class="fa fa-bookmark"></span> <span>Featured</span></span>
				                        <span class="at_post_author"><span class="fa fa-user"></span> <a href="../author/juan-alejandro-rodriguez-morais/index.html">Juan Alejandro Rodríguez Morais</a></span>
				                        <time class="at_post_time" datetime="2014-09-02"><span class="fa fa-calendar"></span> 02 Sep 2014</time>
				                        <span class="at_post_tags"> </span>
				                    </div>
					                <div class="at_post_share">
					                    <h6 class="at_post_share_title">Comparte este post</h6>
					                    <a class="at_post_share_icon" href="http://twitter.com/share?text=Creando%20una%20estrategia%20de%20b%C3%BAfer%20para%20un%20simple%20juego%20(Java)&url=http://trodz.github.io/estrategia-de-bufer/"
					                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
					                        <span class="fa fa-twitter-square"></span>
					                    </a>
					                    <a class="at_post_share_icon" href="https://www.facebook.com/sharer/sharer.php?u=http://trodz.github.io/estrategia-de-bufer/"
					                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
					                        <span class="fa fa-facebook-square"></span>
					                    </a>
					                    <a class="at_post_share_icon" href="https://plus.google.com/share?url=http://trodz.github.io/estrategia-de-bufer/"
					                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
					                        <span class="fa fa-google-plus-square"></span>
					                    </a>
					                </div>
				                </article>
				            </div>
						</div>
					</div>
				</div>
			</div>
	    </div>
	</div>
</div>
<div id="at_mainbody" class="at_post" role="main">
    <div class="row">
        <div class="large-12 columns">
            <div class="at_block">
                <article class="post">
                    <div class="at_post_content">
                        <p>Cuando decidí portear un juego de Mac a Windows me di cuenta que mi estrategia de búfer estaba horrible; a medida que la pantalla actualizaba, muchas imagenes eran omitidas por lo que la pantalla se hacía negra la mayoría del tiempo. <strong>Nadie quiere jugar un juego mal optimizado.</strong> Así que decidí investigar sobre una estrategia para manejar nuestro proceso(Thread) con eficiencia.</p>

<p>Cuando el juego inicia, habrán 4 variables de tipo long: <strong>inicio, tiempoTranscurrido, espera, tiempoDeseado</strong> y una de tipo entero: <strong>FPS</strong> (fotogramas por segundo o frames per second).</p>

<p><strong>FPS:</strong> La visión humana es actualizada con una frecuencia de 60 Hz. Sin embargo, cuando vemos un monitor/televisión, existe un umbral de visión en el cual se da una interrupción de 16 milisegundos entre nuestros ojos y el aparto que produzca imágenes, razón por la cual lo ideal sería que nuestro juego se actualizara a esta frecuencia para que no haya interrupciones indeseadas. </p>

<pre><code>tiempoDeseado = 1000 / FPS 
</code></pre>

<p>Esto nos da 16.667 (el tiempo aproximado de interrupción del umbral).</p>

<p>inicio calculará el tiempo del sistema en nanosegundos por medio de:</p>

<pre><code>inicio = System.nanoTime(); 
</code></pre>

<p>tiempoTranscurrido restará el tiempo actual menos el tiempo de inicio, para ir controlando qué es lo que pasa:</p>

<pre><code>tiempoTranscurrido = System.nanoTime() - inicio;
</code></pre>

<p>y por último espera restará nuestro tiempo deseado menos el tiempo transcurrido. Como este se da en nano segundos, haremos la conversión de nano a mili (entre 1000000):</p>

<pre><code>espera = tiempoDeseado - tiempoTranscurrido / 1000000;
</code></pre>

<p>Esta divisón nos da un resultado de 16 redondeado porque una variable de tipo <strong>long</strong> no presenta decimales. Si quieres comprobarlo, una impresión a la consola nos va a imprimir 16: </p>

<pre><code>System.out.println(espera);
</code></pre>

<p>Ahora… falta algo para que sea failproof (a prueba de fallos). Si por alguna razón, nuestro tiempo de espera llegara a bajar sobre 0, ya sea porque nuestra computadora está teniendo problemas y/o empieza a colgarse, daremos un valor arbitrario a espera de 5:</p>

<pre><code>    if (espera &lt; 0) espera = 5; 
</code></pre>

<h2 id="nuestrocdigodeberaverseas">Nuestro código debería verse así:</h2>

<pre><code>// Atributos privados
private int FPS = 60;
private long tiempoDeseado = 1000 / FPS;

// podemos llamarle como queramos a nuestro game loop, aunque dependerá cómo estemos trabajando
public void run() {

    while (true) // Correrá por siempre

    long inicio, tiempoTranscurrido, espera;

    inicio = System.nanoTime(); 

    tiempoTranscurrido = System.nanoTime() - inicio;

    espera = tiempoDeseado - tiempoTranscurrido / 1000000;

    if (espera &lt; 0) espera = 5;

    System.out.println(espera);

    try {
        Thread.sleep(espera);
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>

<p>La ultima parte del código (<strong>try</strong>, <strong>catch</strong>) va ligado a un manejo de excepciones, que simplemente se encarga de revisar que todo esté bien, de lo contrario nos informará en qué lineas de nuestro código, mediante el <strong>printStackTrace()</strong>, se encuentra nuestro error.</p>

<p>Esta estrategia es más que suficiente para un juego 2D con bajos recursos (Al menos en Java). Espero que les haya servido mi idea. Si tienes preguntas, dudas o algo que quieras implementar deja tu comentario abajo!</p>
                    </div>
                    <h3>About Author</h3>
                    <div class="at_author">
                        <div class="row">
                            <div class="medium-2 columns show-for-medium-up">
                                <div class="at_author_image">
                                    <img src="../content/images/2014/Sep/avatarghost.png" alt="Juan Alejandro Rodríguez Morais">
                                </div>
                            </div>
                            <div class="medium-10 columns">
                                <div class="at_author_name">
                                    <h3>Juan Alejandro Rodríguez Morais</h3>
                                </div>
                                <div class="at_author_bio">
                                    <p>Estudiante de programación, amante del pixel art, la fotografía, la música y el game design.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="at_post_comments">
                        <div id="at_disqus">
                            <div id="disqus_thread">
                        		<a class="button small radius" href="index.html#" onclick="atPost.loadDisqus();return false;"><span class="fa fa-comments"></span> Comentar</a>
                            </div>
                        </div>                    </div>
                </article>
            </div>
        </div>
    </div>
</div>
<div id="at_footer">
	<div class="row">
		<div class="large-12 columns text-center">
			<div class="at_block">
				<div class="copyright">
					<span>&copy; 2014 <a href="http://trodz.github.io/">El aprendiz del game design</a> - Free Ghost Theme<br />Powered by <a href="http://foundation.zurb.com/">Foundation 5 Framework</a> and <a href="http://bourbon.io/">Bourbon Sass Mixins Library</a></span>
				</div>
				<div class="poweredby">
					<span>Orgullosamente publicado con <a class="icon-ghost" href="http://ghost.org">Ghost</a></span>
				</div>
			</div>
		</div>
	</div>
</div>
        </div>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../assets/js/jquery-2.1.0.min.js"><\/script>')</script>

    <script>
        /*** CONFIGURATION VARIABLES: EDIT THE VALUES BELOW FOR THEME CONFIGURATION ***/
        var ghostionConfig = {
            site_url:                       "ghostion.ghostdemo.axiantheme.com",
            google_fonts_family:            "Open+Sans:400,400italic,700,700italic",
            google_analytics_tracking_id:   "UA-45630355-2",
            disqus_shortname:               "timrodz"
        };
    </script>
    <script src="../assets/js/ghostion.min.js"></script>
</body>
</html>